# SHP文件字段检查工具

**作者**: ViVi141  
**邮箱**: 747384120@qq.com  
**版本**: 1.0 正式版
**更新时间**: 2025年7月14日

一个功能强大的SHP文件质量检查工具，支持拓扑检测、属性验证、几何分析等多种检查功能。

## 🚀 功能特点

### 核心功能
- 🔍 **批量检查**: 自动扫描指定目录下的所有SHP文件
- 📊 **字段分析**: 提取并分析每个字段的类型、空值数量、唯一值数量等
- 📁 **相关文件检查**: 检查SHP文件的相关文件（.dbf, .shx, .prj等）
- 📈 **统计报告**: 生成详细的检查报告，支持JSON、CSV、Word格式
- 🎯 **错误处理**: 完善的错误处理机制，记录无法读取的文件

### 增强功能
- 🗺️ **拓扑检测**: 面缝隙检测、面重叠检测
- 🔗 **属性检测**: 结构一致性检查、编号唯一性检查、必填字段检查
- 📐 **几何检测**: 空几何检测、几何有效性验证
- 🔐 **文件哈希值**: SHA256哈希值计算，支持文件完整性验证
- ⏰ **检查时间戳**: 记录每个文件的检查开始和结束时间
- 🖥️ **图形界面**: 友好的GUI界面，操作简单直观
- 📄 **多格式导出**: 支持JSON、CSV、Word格式的检查报告

## 📦 安装依赖

```bash
pip install -r requirements.txt
```

### 依赖包说明
- `geopandas`: 地理数据处理
- `pandas`: 数据分析
- `shapely`: 几何计算
- `pyproj`: 坐标系转换
- `python-docx`: Word文档生成
- `tkinter`: GUI界面（Python内置）

## 🎮 使用方法

### GUI版本（推荐）

```bash
python shp_field_checker_gui.py
```

启动图形界面，通过点击操作完成检查：
1. 选择输入目录
2. 选择输出目录（可选）
3. 点击"开始检查"
4. 查看检查结果（包含哈希值和时间戳）
5. 导出报告

### 使用场景示例

#### 数据完整性验证
```python
# 检查文件是否被修改
import json
with open('shp_field_check_results_20250115_103000.json', 'r') as f:
    results = json.load(f)
    
for file_result in results['files']:
    print(f"文件: {file_result['file_name']}")
    print(f"哈希值: {file_result['file_hash']}")
    print(f"检查时间: {file_result['check_start_time']}")
```

#### 重复文件检测
```python
# 通过哈希值识别重复文件
hash_values = set()
for file_result in results['files']:
    if file_result['file_hash'] in hash_values:
        print(f"发现重复文件: {file_result['file_name']}")
    hash_values.add(file_result['file_hash'])
```

### 命令行版本

```bash
# 基本用法
python shp_field_checker_simple.py "控规_SHAPE_20250227143118"

# 指定输出目录和格式
python shp_field_checker_simple.py "控规_SHAPE_20250227143118" -o ./results -f csv

# 显示详细结果
python shp_field_checker_simple.py "控规_SHAPE_20250227143118" -d
```

## 🔧 检查功能详解

### 1. 拓扑检测
- **面缝隙检测**: 检测相邻面要素之间的微小间隙
- **面重叠检测**: 检测面要素之间的重叠区域
- **容差设置**: 默认0.001，可调整

### 2. 属性检测
- **结构一致性**: 检查标准字段在不同文件中的数据类型一致性
- **编号唯一性**: 检查关键标识字段的唯一性（BSM、TBBH、JBNTTBBH、DKBH、FGUID）
- **必填字段**: 检查必填字段是否存在空值

### 3. 基础检测
- **几何有效性**: 检测空几何要素和无效几何
- **文件完整性**: 检查SHP文件的相关文件是否齐全
- **编码兼容性**: 处理不同编码格式的文件

## 🔐 哈希值与时间戳功能

### 文件哈希值
- **算法**: SHA256
- **格式**: 64位十六进制字符串
- **用途**: 文件完整性验证、重复文件检测、数据审计
- **计算范围**: SHP主文件、相关文件(.dbf, .shx, .prj等)、独立DBF文件

### 检查时间戳
- **开始时间**: 文件检查开始的确切时间
- **结束时间**: 文件检查完成的确切时间
- **格式**: ISO 8601标准格式 (YYYY-MM-DDTHH:MM:SS.microseconds)
- **用途**: 性能分析、进度跟踪、问题诊断

### 性能优化
- **分块读取**: 避免大文件内存溢出
- **流式处理**: 使用迭代器处理大文件
- **异常恢复**: 哈希计算失败时继续其他检查

## 📊 输出结果

### 检查报告格式

#### JSON格式
```json
{
  "summary": {
    "total_files": 58,
    "total_issues": 0,
    "check_time": "2025-01-XX 10:30:00"
  },
  "files": [
    {
      "filename": "example.shp",
      "file_type": "SHP",
      "file_hash": "a92f9b50ef7a52a3a2c8840ed3e4b3308459ea3cd7436dec945ac0e569c2a874",
      "check_start_time": "2025-01-15T10:30:00.123456",
      "check_end_time": "2025-01-15T10:30:05.654321",
      "issues": []
    }
  ]
}
```

#### CSV格式
包含文件名、问题类型、错误描述、文件哈希值、检查时间戳等信息的表格。

#### Word格式
详细的检查报告，包含图表、统计信息和文件详细信息表格（含哈希值和时间戳）。

## 🎯 字段标准

### 标准来源
默认的字段标准是依据以下规范制定的：
- **《中山市自然资源数据标准规范及质检规范说明》**
- **《国土空间基础信息平台数据编目配置的质检规则》**

这些标准确保了数据检查的规范性和权威性，符合国土空间规划数据管理的要求。

### 标准规范说明

#### 《中山市自然资源数据标准规范及质检规范说明》
- **适用范围**: 中山市自然资源数据管理
- **主要内容**: 数据标准定义、质检规范、质量控制要求
- **应用领域**: 国土空间规划、自然资源管理

#### 《国土空间基础信息平台数据编目配置的质检规则》
- **适用范围**: 全国国土空间基础信息平台
- **主要内容**: 数据编目标准、质检规则、平台配置要求
- **应用领域**: 国土空间规划、基础信息平台建设

### 标准遵循原则
- **规范性**: 严格遵循国家和地方标准规范
- **权威性**: 基于官方发布的质检规则
- **实用性**: 结合实际应用需求制定
- **可扩展性**: 支持自定义和扩展标准

### 标准规范重要性
- **数据质量保障**: 确保检查结果符合行业标准
- **合规性要求**: 满足国土空间规划数据管理要求
- **权威性认可**: 基于官方规范，具有权威性
- **应用推广**: 便于在政府部门和企事业单位推广应用

### 内置字段标准

#### 基本字段
- BSM（标识码）、YSDM（要素代码）、TBBH（图斑编号）
- DLBM（地类编码）、DLMC（地类名称）
- QSXZ（权属性质）、QSDWMC（权属单位名称）
- 等等...

#### 控规字段
- CGLB（城规类别）、CGYDDM（城规用地代码）
- JZMDX/JZMDZ（建筑密度上下限）
- RJLSX/RJLXX（容积率上下限）
- LDLSX/LDLLX（绿地率上下限）
- 等等...

## 🔄 更新记录

### v1.0 正式版
- 🎉 完整功能版本发布
- 🖥️ GUI图形界面
- 🔍 拓扑检测功能（面缝隙、面重叠）
- 📊 属性检测算法（结构一致性、编号唯一性、必填字段）
- 📐 几何检测（空几何、几何有效性）
- 🔐 SHA256文件哈希值计算
- ⏰ 检查时间戳记录
- 📁 相关文件哈希值计算
- 📄 多格式报告导出（JSON、CSV、Word）
- 🎯 完善的错误处理机制

## 🐛 常见问题

### Q: 检查速度慢怎么办？
A: 大量文件时属正常现象，建议分批检查或使用SSD硬盘。哈希值计算会增加一些时间，但能提供文件完整性验证。

### Q: 编码错误如何处理？
A: 工具会自动尝试多种编码格式，无法读取的文件会记录在错误日志中。

### Q: 如何自定义字段标准？
A: 修改代码中的`FIELD_STANDARDS`字典即可。

### Q: 哈希值有什么用途？
A: 哈希值可用于文件完整性验证、重复文件检测、数据审计等场景。

### Q: 时间戳格式是什么？
A: 使用ISO 8601标准格式（YYYY-MM-DDTHH:MM:SS.microseconds），便于程序处理和人工阅读。

### Q: 字段标准是如何制定的？
A: 默认字段标准依据《中山市自然资源数据标准规范及质检规范说明》与《国土空间基础信息平台数据编目配置的质检规则》制定，确保数据检查的规范性和权威性。

## 📚 标准规范引用

### 主要参考规范
1. **《中山市自然资源数据标准规范及质检规范说明》**
   - 发布机构：中山市自然资源局
   - 适用范围：中山市自然资源数据管理
   - 主要内容：数据标准定义、质检规范、质量控制要求

2. **《国土空间基础信息平台数据编目配置的质检规则》**
   - 发布机构：自然资源部
   - 适用范围：全国国土空间基础信息平台
   - 主要内容：数据编目标准、质检规则、平台配置要求

## 📞 技术支持

如有问题或建议，请联系：
- **作者**: ViVi141
- **邮箱**: 747384120@qq.com
- **QQ**: 747384120

## 📄 许可证

本项目采用MIT许可证，详见LICENSE文件。

## 🙏 致谢

感谢所有贡献者和用户的支持与反馈！

---

**© 2025 ViVi141. All rights reserved.** 